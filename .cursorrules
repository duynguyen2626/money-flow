# PROJECT CONTEXT
- Name: Money Flow 3
- Stack: Next.js 15 (App Router), TypeScript, Tailwind CSS, Shadcn UI, Supabase.

# CODING STANDARDS & RULES
@.cursorrules @src/components/moneyflow/unified-transaction-table.tsx @src/app/transactions/page.tsx @src/types/moneyflow.types.ts



## 1. General Principles
- **Conciseness:** Write concise, technical responses. Avoid verbosity.
- **Type Safety:** NO `any`. Always use defined types from `src/types` or `database.types.ts`.
- **Functional:** Prefer functional programming patterns. Use `const` over `let`.
- **Server Actions:** Use Server Actions for mutations. Ensure `revalidatePath` is called after updates.
- **Error Handling:** Always wrap Server Actions in try-catch blocks. Return `{ success: boolean, error?: string, data?: T }`.

## 2. Next.js 15 & React Guidelines
- **RSC:** Default to React Server Components. Use `'use client'` only when interactivity (hooks, event listeners) is needed.
- **Shadcn UI:** Use existing Shadcn components in `src/components/ui`. Do not reinvent the wheel.
- **Forms:** Use `react-hook-form` with `zod` schema validation.
- **Loading:** Use `Suspense` boundaries and `loading.tsx` for async operations.

## 3. Supabase Best Practices
- **Clients:**
  - Use `createClient` from `src/lib/supabase/server.ts` for Server Components/Actions.
  - Use `createClient` from `src/lib/supabase/client.ts` for Client Components.
- **RLS:** Always assume RLS is enabled. Do not bypass RLS unless explicitly instructed (using service role).
- **Queries:** Select specific columns, avoid `select('*')` when possible.

## 4. Money Flow 3 Business Logic (CRITICAL)
- **Single Source of Truth:** The `transactions` table is the ONLY source for financial data.
- **Debt Logic:**
  - Debt is tracked via `person_id` in `transactions`.
  - **PROHIBITED:** Do NOT create or query generic "Debt Accounts" (Double Entry System Legacy).
  - Calculate debt by aggregating `transactions` where `person_id` is present.
- **Refunds & Integrity:**
  - **Refund Trio:** Parent -> Void -> Refund.
  - **Strict Rule:** NEVER allow editing/voiding a Parent transaction if it has linked children (Void/Refund). The children must be deleted first.
- **Batches:** When processing batches, check for duplicates using `transaction_date`, `amount`, and `details`.
- **Installments:** Installments are linked to `transaction_lines` (or flag `is_installment`). Do not double-count parent and installments in totals.

## 5. UI/UX Design System (STRICT - PHASE 74)
- **Images/Avatars:**
  - **Account/Person/Item Thumbnails:** MUST be **`rounded-none`** (Square). NEVER use `rounded-full` or `rounded-md` in tables.
  - Standard size: `w-8 h-8` or `w-10 h-10`.
- **Transaction Table:**
  - **Columns:** Merge "Account" and "People" into **"Accounts âžœ People"**.
  - **Alignment:** Account (Left) -> Arrow (Center) -> People (Right).
  - **Row Interaction:** Clicking a table row (`<TableRow>`) MUST NOT trigger any action. ONLY the "Actions" menu (`...`) or specific buttons can trigger Modals.
- **Data Formatting:**
  - **Cycle Tags:** Display distinct ranges (e.g., "25.10 - 24.11") instead of just raw tags (e.g., "NOV25").
  - **Cashback:** Show "Need to Spend" badges in Yellow/Amber if Min Spend is not met.

## 6. Testing & Validation
- **Self-Correction:** Before outputting code, verify imports are correct and unused variables are removed.
- **Linting:** Ensure code passes ESLint rules (no unused imports, no console.log in production code).

